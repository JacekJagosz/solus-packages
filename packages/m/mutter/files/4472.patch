From 00ec7424cf0add61dd83b53f03194f90a3ebc91f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Sun, 1 Jun 2025 12:45:17 +0200
Subject: [PATCH 1/3] frames/window-tracker: Check for frame in the
 client_windows hashtable

Based on a patch from Sebastian Keller

Fixes: 4d194b8e1 ("frames/window-tracker: Handle override-redirect attribute change.")
---
 src/frames/meta-window-tracker.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/frames/meta-window-tracker.c b/src/frames/meta-window-tracker.c
index 18801f5c3f..acbcad0790 100644
--- a/src/frames/meta-window-tracker.c
+++ b/src/frames/meta-window-tracker.c
@@ -275,7 +275,7 @@ on_xevent (GdkDisplay *display,
 
       xwindow = xevent->xconfigure.window;
       has_frame =
-        g_hash_table_contains (window_tracker->frames,
+        g_hash_table_contains (window_tracker->client_windows,
                                GUINT_TO_POINTER (xwindow));
 
       if (!xevent->xconfigure.override_redirect && !has_frame)
-- 
GitLab


From 98394378343c07e2f010e19f9e63e077e4547ca0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Sun, 1 Jun 2025 12:45:29 +0200
Subject: [PATCH 2/3] frames/window-tracker: Ignore ConfigureNotify on the root
 window

Based on a patch from Sebastian Keller

Fixes: 4d194b8e1 ("frames/window-tracker: Handle override-redirect attribute change.")
---
 src/frames/meta-window-tracker.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/frames/meta-window-tracker.c b/src/frames/meta-window-tracker.c
index acbcad0790..654c8ed4c0 100644
--- a/src/frames/meta-window-tracker.c
+++ b/src/frames/meta-window-tracker.c
@@ -269,7 +269,8 @@ on_xevent (GdkDisplay *display,
       listen_set_up_frame (window_tracker, xwindow);
     }
   else if (xevent->type == ConfigureNotify &&
-           xevent->xconfigure.event == xroot)
+           xevent->xconfigure.event == xroot &&
+           xevent->xconfigure.window != xroot)
     {
       gboolean has_frame;
 
-- 
GitLab


From ededbf0a9a4a1a500c467b966fd14e1965f43b8a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Sun, 1 Jun 2025 12:45:41 +0200
Subject: [PATCH 3/3] frames/window-tracker: Ignore ConfigureNotify on the
 frame windows

Fixes: 4d194b8e1 ("frames/window-tracker: Handle override-redirect attribute change.")
Closes: https://gitlab.gnome.org/GNOME/mutter/-/issues/4133
---
 src/frames/meta-window-tracker.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/frames/meta-window-tracker.c b/src/frames/meta-window-tracker.c
index 654c8ed4c0..3f08388b5e 100644
--- a/src/frames/meta-window-tracker.c
+++ b/src/frames/meta-window-tracker.c
@@ -270,7 +270,9 @@ on_xevent (GdkDisplay *display,
     }
   else if (xevent->type == ConfigureNotify &&
            xevent->xconfigure.event == xroot &&
-           xevent->xconfigure.window != xroot)
+           xevent->xconfigure.window != xroot &&
+           !g_hash_table_contains (window_tracker->frames,
+                                   GUINT_TO_POINTER (xevent->xconfigure.window)))
     {
       gboolean has_frame;
 
-- 
GitLab

