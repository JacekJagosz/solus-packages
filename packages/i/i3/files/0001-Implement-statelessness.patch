From 5e021e7b2b73e32468f5043d621b8e62fc1bdee9 Mon Sep 17 00:00:00 2001
From: Ivan Trepakov <liontiger23@gmail.com>
Date: Tue, 21 Oct 2025 08:58:59 +0700
Subject: [PATCH] [PATCH 1/1] Implement statelessness.

---
 i3-config-wizard/main.c |  4 ++--
 libi3/get_config_path.c | 10 ++++++++--
 meson.build             |  2 +-
 3 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/i3-config-wizard/main.c b/i3-config-wizard/main.c
index 96baff00fb..ebaab907a3 100644
--- a/i3-config-wizard/main.c
+++ b/i3-config-wizard/main.c
@@ -685,9 +685,9 @@ static void finish(void) {
         errx(1, "xkb_x11_keymap_new_from_device failed");
     }
 
-    FILE *kc_config = fopen(SYSCONFDIR "/i3/config.keycodes", "r");
+    FILE *kc_config = fopen("/usr/share/defaults/i3/config.keycodes", "r");
     if (kc_config == NULL) {
-        err(1, "Could not open input file \"%s\"", SYSCONFDIR "/i3/config.keycodes");
+        err(1, "Could not open input file \"%s\"", "/usr/share/defaults/i3/config.keycodes");
     }
 
     FILE *ks_config = fopen(config_path, "w");
diff --git a/libi3/get_config_path.c b/libi3/get_config_path.c
index c401d74142..e67e31acdf 100644
--- a/libi3/get_config_path.c
+++ b/libi3/get_config_path.c
@@ -60,7 +60,13 @@ char *get_config_path(const char *override_configpath, bool use_system_paths) {
         return NULL;
     }
 
-    /* 3: check for $XDG_CONFIG_DIRS/i3/config */
+    /* 3: check stateless directory */
+    config_path = "/usr/share/defaults/i3/config";
+    if (path_exists(config_path))
+        return config_path;
+    free(config_path);
+
+    /* 4: check for $XDG_CONFIG_DIRS/i3/config */
     if ((xdg_config_dirs = getenv("XDG_CONFIG_DIRS")) == NULL) {
         xdg_config_dirs = SYSCONFDIR "/xdg";
     }
@@ -80,7 +86,7 @@ char *get_config_path(const char *override_configpath, bool use_system_paths) {
     }
     free(buf);
 
-    /* 4: check the traditional path under /etc */
+    /* 5: check the traditional path under /etc */
     config_path = SYSCONFDIR "/i3/config";
     if (path_exists(config_path)) {
         return sstrdup(config_path);
diff --git a/meson.build b/meson.build
index 0995af9385..168b662759 100644
--- a/meson.build
+++ b/meson.build
@@ -594,7 +594,7 @@ install_data(
 install_subdir(
   'etc',
   strip_directory: true,
-  install_dir: join_paths(get_option('sysconfdir'), 'i3'),
+  install_dir: join_paths(get_option('prefix'), 'share', 'defaults', 'i3'),
 )
 
 install_subdir(

