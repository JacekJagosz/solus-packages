name       : scx-scheds
version    : 1.0.17
release    : 2
source     :
    - https://github.com/sched-ext/scx/archive/refs/tags/v1.0.17.tar.gz : 2f9dbce619f6fd547fabcd4ef1220fe125f1277218e9d8bfbabdb4063c8417b9
homepage   : https://github.com/sched-ext/scx
license    : MIT
component  : system.utils
summary    : sched_ext schedulers and tools
description: |
    sched_ext schedulers and tools
clang      : true
networking : true
builddeps  :
    - pkgconfig(libbpf)
    - pkgconfig(libelf)
    - pkgconfig(libjq)
    - pkgconfig(libseccomp)
    - pkgconfig(libsystemd)
    - pkgconfig(protobuf)
    - linux-tools-bpftool
    - rust-devel
environment: |
    # sscache is broken for this build. Disable it for now.
    unset RUSTC_WRAPPER
setup      : |
    %meson_configure -Dbpftool=disabled \
                     -Dlibbpf_a=disabled \
                     -Dvendordir=/usr/share/defaults/
    %cargo_fetch
build      : |
    %ninja_build
install    : |
    %ninja_install

    # Use custom config.
    install -Dm00644 $pkgfiles/config.toml $installdir/usr/share/defaults/scx_loader/config.toml

    # Enable service
    install -Ddm00755 $installdir/usr/lib/systemd/system/sysinit.target.wants
    ln -sv ../scx_loader.service $installdir/usr/lib/systemd/system/sysinit.target.wants/scx_loader.service
patterns   :
    - devel : /usr/bin/vmlinux_docify
